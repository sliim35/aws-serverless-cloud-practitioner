Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    Timeout: 3

Resources:
  ApiGateway:
    Type: AWS::Serverless::HttpApi
    Properties:
      CorsConfiguration:
        AllowOrigins:
          - "*"
        AllowMethods:
          - GET
          - POST
          - DELETE
        MaxAge: 600
      StageName: dev

  GetProductsList:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/
      Handler: getProductsList.handler
      Runtime: nodejs18.x
      Policies:
        - AWSLambdaBasicExecutionRole
      Events:
        Products:
          Type: HttpApi
          Properties:
            ApiId: !Ref ApiGateway
            Path: /products
            Method: get
      Environment:
        Variables:
          TABLE_NAME: !Ref Products
    Metadata:
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: es2020
        Sourcemap: true
        EntryPoints:
          - getProductsList.ts
    Connectors:
      GetProductsConnector:
        Properties:
          Destination:
            Id: Products
          Permissions:
            - Read

  GetProductsById:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/
      Handler: getProductsById.handler
      Runtime: nodejs18.x
      Policies:
        - AWSLambdaBasicExecutionRole
      Events:
        Products:
          Type: HttpApi
          Properties:
            ApiId: !Ref ApiGateway
            Path: /products/{id}
            Method: get
      Environment:
        Variables:
          TABLE_NAME: !Ref Products
    Metadata:
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: es2020
        Sourcemap: true
        EntryPoints:
          - getProductsById.ts
    Connectors:
      GetProductByIdConnector:
        Properties:
          Destination:
            Id: Products
          Permissions:
            - Read

  Products:
    Type: AWS::Serverless::SimpleTable
    Properties:
      TableName: Products
      PrimaryKey:
        Name: id
        Type: String
